(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-01e56cef"],{"0179":function(e,t,n){},"08f5":function(e,t,n){},7091:function(e,t,n){"use strict";var i=n("0179"),a=n.n(i);a.a},7687:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-container",[n("el-aside",{staticStyle:{"background-color":"rgb(238, 241, 246)"},attrs:{width:"30%"}},[n("my-tree")],1),e._v(" "),n("el-container",[n("el-header",{staticStyle:{"font-size":"12px"}},[n("el-button",{directives:[{name:"show",rawName:"v-show",value:!(e.tree_editing||!e.curNodeid),expression:"!tree_editing && curNodeid?true:false"}],attrs:{type:"primary"},on:{click:function(t){e.dialogFormVisible=!0}}},[e._v("+添加变量")]),e._v(" "),n("el-dialog",{attrs:{title:"添加变量",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[n("el-form",{attrs:{model:e.form}},[n("el-form-item",{attrs:{label:"变量名","label-width":e.formLabelWidth}},[n("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"单位","label-width":e.formLabelWidth}},[n("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.unit,callback:function(t){e.$set(e.form,"unit",t)},expression:"form.unit"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"类型大小","label-width":e.formLabelWidth}},[n("el-select",{attrs:{placeholder:"请选择类型"},model:{value:e.form.size,callback:function(t){e.$set(e.form,"size",t)},expression:"form.size"}},[n("el-option",{attrs:{label:"1Byte",value:"1"}}),e._v(" "),n("el-option",{attrs:{label:"2Bytes",value:"2"}}),e._v(" "),n("el-option",{attrs:{label:"4Bytes",value:"4"}})],1)],1)],1),e._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.addVariable}},[e._v("确 定")])],1)],1)],1),e._v(" "),n("el-main",[n("el-table",{attrs:{data:e.tableData}},[n("el-table-column",{attrs:{prop:"name",label:"变量名"}}),e._v(" "),n("el-table-column",{attrs:{prop:"unit",label:"单位"}}),e._v(" "),n("el-table-column",{attrs:{prop:"size",label:"类型大小"}}),e._v(" "),n("el-table-column",{attrs:{prop:"value",label:"数值"}}),e._v(" "),n("el-table-column",{attrs:{label:"操作",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(n){return e.handleEdit(t.$index,t.row)}}},[e._v("编辑")]),e._v(" "),n("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(n){return e.handleDelete(t.$index,t.row)}}},[e._v("删除")])]}}])})],1)],1)],1)],1)},a=[],o=(n("7f7f"),n("ac6a"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],staticClass:"comp-tree"},[n("el-button",{staticClass:"comp-tr-top",attrs:{type:"primary",size:"small",disabled:""},on:{click:e.handleAddTop}},[e._v("添加顶级节点")]),e._v(" "),n("el-button",{staticStyle:{float:"right"},attrs:{type:"primary",size:"small"},on:{click:e.handleSaveTree}},[e._v(e._s(e.enable_edit?"保存":"编辑"))]),e._v(" "),n("el-tree",{ref:"SlotTree",attrs:{data:e.setTree,props:e.defaultProps,"expand-on-click-node":!1,"highlight-current":"",accordion:"","node-key":e.NODE_KEY},on:{"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.node,a=t.data;return n("div",{staticClass:"comp-tr-node"},[i.isEdit?[n("el-input",{ref:"slotTreeInput"+a[e.NODE_KEY],attrs:{autofocus:"",size:"mini"},on:{blur:function(t){return t.stopPropagation(),e.handleInput(i,a)}},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleInput(i,a)}},model:{value:a.name,callback:function(t){e.$set(a,"name",t)},expression:"data.name"}})]:[n("span",{class:[a[e.NODE_KEY]<e.NODE_ID_START?"is-new":"","comp-tr-node--name"]},[n("svg-icon",{attrs:{"icon-class":"guide"}}),e._v(" "+e._s(i.label)+"\n        ")],1),e._v(" "),n("span",{directives:[{name:"show",rawName:"v-show",value:e.enable_edit,expression:"enable_edit"}],staticClass:"comp-tr-node--btns"},[n("el-button",{attrs:{icon:"el-icon-plus",size:"mini",circle:"",type:"primary"},on:{click:function(t){return e.handleAdd(i,a)}}}),e._v(" "),n("el-button",{attrs:{icon:"el-icon-edit",size:"mini",circle:"",type:"info"},on:{click:function(t){return e.handleEdit(i,a)}}}),e._v(" "),n("el-button",{attrs:{icon:"el-icon-delete",size:"mini",circle:"",type:"danger"},on:{click:function(t){return e.handleDelete(i,a)}}})],1)]],2)}}])})],1)}),r=[],s={maxexpandId:95,treelist:[]},l=n("8610"),c={name:"Test",data:function(){return{nodeIcon:"el-icon-guide",isLoading:!1,setTree:s.treelist||[],NODE_KEY:"id",MAX_LEVEL:5,NODE_ID_START:0,startId:null,defaultProps:{children:"children",label:"name"},initParam:{name:"新增节点",pid:0,children:[]},enable_edit:!1}},created:function(){this.startId=this.NODE_ID_START},mounted:function(){var e=this;Object(l["c"])().then(function(t){console.log(t),e.setTree=t.tree,e.startId=t.max_id})},methods:{handleDelete:function(e,t){var n=this;if(console.log(e,t),t.children&&0!==t.children.length)return this.$message.error("此节点有子级，不可删除！"),!1;var i=function(){n.$nextTick(function(){n.$refs.SlotTree&&n.$refs.SlotTree.remove(t)})},a=function(){var e=t.is_leaf?"请先确定所有变量已删除完毕，否则无法删除!":"是否删除此节点？";n.$confirm(e,"提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(function(){i()}).catch(function(){})};t[this.NODE_KEY]<this.NODE_ID_START?i():a(),Object(l["b"])(t).then(function(e){console.log(t),200===e.code?n.$message.success("删除成功"):n.$message.error("删除不成功，请刷新！")})},handleInput:function(e,t){var n=this;console.log(e,t),e.isEdit&&this.$set(e,"isEdit",!1),Object(l["e"])(t).then(function(e){console.log(t),200===e.code?n.$message.success("修改成功"):n.$message.error("修改不成功，请刷新！")})},handleEdit:function(e,t){var n=this;console.log(e,t),e.isEdit||this.$set(e,"isEdit",!0),this.$nextTick(function(){n.$refs["slotTreeInput"+t[n.NODE_KEY]]&&n.$refs["slotTreeInput"+t[n.NODE_KEY]].$refs.input.focus()})},handleAdd:function(e,t){var n=this;if(console.log(e,t),e.level>=this.MAX_LEVEL)return this.$message.warning("当前已达到"+this.MAX_LEVEL+"级，无法新增！"),!1;var i=JSON.parse(JSON.stringify(this.initParam));i.pid=t[this.NODE_KEY],i[this.NODE_KEY]=++this.startId,t.children||this.$set(t,"children",[]),e.level===this.MAX_LEVEL-1&&(i["is_leaf"]=!0),t.children.push(i),e.expanded||(e.expanded=!0),Object(l["a"])(i).then(function(e){console.log(i),200===e.code?n.$message.success("添加成功"):n.$message.error("添加不成功，请刷新！")})},handleAddTop:function(){var e=JSON.parse(JSON.stringify(this.initParam));e[this.NODE_KEY]=++this.startId,this.setTree.push(e)},handleSaveTree:function(){var e=this;this.enable_edit=!this.enable_edit,this.$store.dispatch("treechart/changeTreeStatus",this.enable_edit),this.enable_edit||(console.log("save tree"),console.log(this.setTree),Object(l["d"])(this.setTree).then(function(t){console.log(t),200===t.code?e.$message.success("保存成功"):e.$message.error("保存不成功，请重试！")}))},handleNodeClick:function(e){e.is_leaf&&(console.log(e),this.$store.dispatch("treechart/changeTreeNode",e.id))}}},d=c,u=(n("7091"),n("2877")),h=Object(u["a"])(d,o,r,!1,null,null,null),f=h.exports,m=n("b775");function p(e){return Object(m["a"])({url:"/equipment/variable?id="+e,method:"get",params:e})}function b(e){return Object(m["a"])({url:"/equipment/variable",method:"post",data:e})}function v(e){return Object(m["a"])({url:"/equipment/variable",method:"delete",data:e})}var _={components:{"my-tree":f},data:function(){return{tree_editing:!1,tableData:[],dialogFormVisible:!1,form:{name:"",unit:"",size:"",delivery:!1,resource:"",desc:""},formLabelWidth:"120px",filterText:"",curNodeid:null}},watch:{"$store.getters.treenode":function(){var e=this,t=this.$store.getters.treenode;this.curNodeid=t,console.log("the treenode is ",t),p(t).then(function(t){console.log(t);var n=t.data;if(n){var i=[];n.forEach(function(e){i.push({id:e.id,name:e.name,unit:e.unit,size:e.type+" Byte",value:Math.floor(100*Math.random()+1)})}),e.tableData=i}})},"$store.getters.treestatus":function(){this.tree_editing=this.$store.getters.treestatus,console.log(this.tree_editing)}},methods:{changeTreeState:function(){this.enable_edit=!this.enable_edit},handleEdit:function(e,t){console.log(e,t)},handleDelete:function(e,t){var n=this;console.log(e,t);var i=this.tableData[e];i["node_id"]=this.curNodeid,v(i).then(function(t){200===t.code?(n.$message.success("删除变量成功"),n.tableData.splice(e,1)):n.$message.error("删除变量不成功，请刷新！")})},addVariable:function(){var e=this;this.dialogFormVisible=!1;var t={name:this.form.name,unit:this.form.unit,size:this.form.size,value:null,node_id:this.curNodeid};b(t).then(function(n){console.log(t),200===n.code?(e.$message.success("添加变量成功"),e.tableData.push(t)):e.$message.error("添加变量不成功，请刷新！")})}}},g=_,E=(n("e528"),Object(u["a"])(g,i,a,!1,null,null,null));t["default"]=E.exports},8610:function(e,t,n){"use strict";n.d(t,"c",function(){return a}),n.d(t,"d",function(){return o}),n.d(t,"e",function(){return r}),n.d(t,"a",function(){return s}),n.d(t,"b",function(){return l});var i=n("b775");function a(){return Object(i["a"])({url:"/tree",method:"get"})}function o(e){return Object(i["a"])({url:"/tree",method:"post",data:e})}function r(e){return Object(i["a"])({url:"/tree",method:"patch",data:e})}function s(e){return Object(i["a"])({url:"/tree",method:"post",data:e})}function l(e){return Object(i["a"])({url:"/tree",method:"delete",data:e})}},e528:function(e,t,n){"use strict";var i=n("08f5"),a=n.n(i);a.a}}]);